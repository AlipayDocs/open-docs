# 简介

支付宝密钥工具是用于对应用的客户端服务端之间的交互进行加密保护, 主要功能有生成密钥、签名、验签、格式转换、密钥匹配。

# 工具下载

- [Web 在线加密](https://miniu.alipay.com/keytool/create)（免下载）
- [WINDOWS](https://ideservice.alipay.com/ide/getPluginUrl.htm?clientType=assistant&platform=win&channelType=WEB)（windows 版本工具请不要安装在含有空格的目录路径下，否则会导致公私钥乱码的问题）
- [MAC_OSX](https://ideservice.alipay.com/ide/getPluginUrl.htm?clientType=assistant&platform=mac&channelType=WEB)

# 功能介绍

| **功能** | **描述** |
| --- | --- |
| [生成密钥](https://opendocs.alipay.com/open/291/105971) | 生成应用公钥（public key）、应用私钥（private key）和公钥证书申请 CSR 文件，支持 RSA2 、RSA、国密三种签名算法。<br />**说明：** 目前暂不支持国密的加签方式，即使获取后也无法设置加签。 |
| [签名](https://opendocs.alipay.com/open/291/sign) | 使用商户应用私钥对请求参数做签名。 |
| [验签](https://opendocs.alipay.com/open/291/106097) | 对支付宝异步通知内容做验签。 |
| [格式转换](https://opendocs.alipay.com/open/291/format-conversion) | 实现不同格式私钥之间、私钥与公钥之间的转换。 |
| [密钥匹配](https://opendocs.alipay.com/open/291/key-matching) | 校验应用私钥和应用公钥是否匹配。 |

## 签名算法简介

支付宝开放平台开发助手生成秘钥主要使用 RSA2 、国密和 RSA 三种签名算法。签名主要包含两个过程：摘要和非对称加密。首先对需要签名的数据做摘要（类似于常见的 MD5）后得到摘要结果，然后通过签名者的私钥对摘要结果进行非对称加密即可得到签名结果。详情请参见 [What is a Digital Signature?](http://www.youdzone.com/signature.html)、[数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)。 新建应用只支持 RSA2 签名方式（安全能力高于 RSA），目前已使用 RSA 签名方式的应用仍然可以正常调用接口，详情请参见 [开放平台证书升级指南](https://opendocs.alipay.com/open/291/twngcd)。

| **签名算法** | **标准签名算法** | **描述** |
| --- | --- | --- |
| RSA2 | SHA256WithRSA | 强制要求 RSA 密钥的长度至少为 2048。 |
| RSA | SHA1WithRSA | 对 RSA 密钥的长度不限制，推荐使用 2048 位以上。 |

**注意：**

- 协议参数：开放平台的报文标准中，sign_type 参数用于指定签名算法，若使用 SHA256WithRSA 签名算法则在报文中需要指定 sign_type=RSA2，若您使用开放平台 SDK，详情可参见 [使用生成密钥请求签名](https://opendocs.alipay.com/open/291/105974)。
- 避免公私钥混用：不同签名算法的签名密钥是隔离的。由于同时提供了两套签名算法，若选择了特定的签名算法，请保证使用对应的私钥签名，同时使用对应的支付宝公钥进行验签。

## 签名方式简介

支付宝开放平台支持使用 普通公钥、公钥证书 两种签名方式。普通公钥方式即生成一对 RSA 密钥（应用公钥、应用私钥），使用公钥（public key）为系统进行加密，并将密文发送给解密者，解密者使用私钥（private key）解密将密文解码为明文。公钥证书方式即在普通公钥的基础上增加证书签名，证书签名的优势在于引入了 CA 机构对公钥持有者进行身份识别，保证该证书所属实体的真实性，以实现报文的抗抵赖，具备更高的安全性。

## 公钥证书说明

- 开放平台在开发者配置应用公钥证书后，自动创建开放平台证书。
- 支付宝开放平台提供对 X.509 格式证书的支持，开发者上传证书后，后续在和支付宝开放平台交互过程中支付宝会尝试使用该证书进行报文验签。在报文签名场景下，报文接受方使用发送方的公钥进行报文验签即可。
- 证书引入了 CA 机构对公钥持有者进行身份识别，保证该证书所属实体的真实性，以实现报文的抗抵赖。
- 只有 RSA2 签名算法支持证书。
- 支持自签名证书，建议由权威 CA 机构签发。
- 证书必须在有效期内。证书有效期是指证书能够实现其声明功能的期限，证书的功能可包括：签名、加密、身份鉴别。若开发者发现应用证书即将过期，请尽量在证书到期前的一个月前就开始准备证书替换。
  - 对于签名用途的证书，其私钥只能在证书有效期内才可以用于数字签名，私钥的使用期限不能超过证书的有效期限。因此，证书有效期过后，其对应的私钥也相应失效，不能再用于签名，公钥验证也不能通过。当用户的证书过期后，接口中使用的证书验证方式将失效，导致 openapi 调用失败。但是为了保证在证书有效期内签名的信息可以验证，公钥的使用期限可以在证书的有限期限以外。
  - 对于身份鉴别用途的证书，其私钥和公钥只能在证书有效期内才可以使用。证书到期后，在保证安全的情况下，允许使用原密钥对对证书进行更新，但是密钥对不能无限期使用。
